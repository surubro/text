<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Editor (Login Required)</title>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f6fa;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    .container {
      width: 100%;
      max-width: 600px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,.1);
    }
    h1 { font-size: 20px; margin-bottom: 20px; }
    label { font-size: 14px; display: block; margin-top: 10px; }
    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 5px;
    }
    textarea {
      width: 100%;
      height: 300px;
      margin-top: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      font-family: monospace;
      resize: vertical;
    }
    button {
      padding: 10px 16px;
      margin-top: 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn-primary { background: #1f6feb; color: #fff; }
    .btn-secondary { background: #eee; }
    .hidden { display: none; }
    #log { font-size: 13px; color: #555; margin-top: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Editor (Verified Users Only)</h1>

    <!-- Login form -->
    <div id="loginBox">
      <label>Email</label>
      <input type="email" id="email" placeholder="you@example.com">
      <label>Password</label>
      <input type="password" id="password" placeholder="••••••••">
      <button id="loginBtn" class="btn-primary">Login</button>
    </div>

    <!-- Editor -->
    <div id="editorBox" class="hidden">
      <textarea id="text-content"></textarea>
      <div>
        <button id="saveBtn" class="btn-primary">Save</button>
        <button id="reloadBtn" class="btn-secondary">Reload</button>
        <button id="logoutBtn" class="btn-secondary">Logout</button>
      </div>
    </div>

    <div id="log"></div>
  </div>

  <script>
    // Firebase config (your project)
    const firebaseConfig = {
      apiKey: "AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
      authDomain: "striped-acrobat-342207.firebaseapp.com",
      databaseURL: "https://striped-acrobat-342207-default-rtdb.firebaseio.com",
      projectId: "striped-acrobat-342207",
      storageBucket: "striped-acrobat-342207.appspot.com",
      messagingSenderId: "367114842706",
      appId: "1:367114842706:web:0f6d504163ed3c72ed658b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const filePath = "text_txt"; // same as before
    const loginBox = document.getElementById("loginBox");
    const editorBox = document.getElementById("editorBox");
    const textarea = document.getElementById("text-content");
    const logDiv = document.getElementById("log");

    function log(msg) {
      logDiv.textContent += msg + "\n";
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    // Auth state
    firebase.auth().onAuthStateChanged(user => {
      if (user && user.emailVerified) {
        loginBox.classList.add("hidden");
        editorBox.classList.remove("hidden");
        log("Logged in as " + user.email);
        loadFile();
      } else {
        loginBox.classList.remove("hidden");
        editorBox.classList.add("hidden");
      }
    });

    document.getElementById("loginBtn").onclick = async () => {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      try {
        await firebase.auth().signInWithEmailAndPassword(email, pass);
        log("Login success");
      } catch (e) {
        log("Login error: " + e.message);
      }
    };

    document.getElementById("logoutBtn").onclick = () => {
      firebase.auth().signOut();
      log("Logged out");
    };

    async function loadFile() {
      try {
        const snap = await db.ref(filePath).get();
        if (snap.exists()) {
          textarea.value = snap.val();
          log("File loaded");
        } else {
          textarea.value = "";
          log("No file found, starting empty");
        }
      } catch (e) {
        log("Error loading: " + e.message);
      }
    }

    document.getElementById("reloadBtn").onclick = loadFile;

    document.getElementById("saveBtn").onclick = async () => {
      try {
        await db.ref(filePath).set(textarea.value);
        log("File saved");
      } catch (e) {
        log("Error saving: " + e.message);
      }
    };
  </script>
</body>
</html>
