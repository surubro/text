<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit and Save to Firebase</title>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
</head>
<body>
  <h1>Firebase Text Editor</h1>

  <!-- Login box -->
  <div id="loginBox">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
  </div>

  <!-- Editor -->
  <textarea id="text-content" placeholder="Loading..."></textarea>
  <br>
  <button id="saveBtn">Save</button>
  <button id="reloadBtn">Reload</button>
  <button id="logoutBtn" style="display:none;">Logout</button>

  <pre id="log"></pre>

  <script>
    // Firebase config (same as your file)
    const firebaseConfig = {
      apiKey: "AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
      authDomain: "striped-acrobat-342207.firebaseapp.com",
      databaseURL: "https://striped-acrobat-342207-default-rtdb.firebaseio.com",
      projectId: "striped-acrobat-342207",
      storageBucket: "striped-acrobat-342207.appspot.com",
      messagingSenderId: "367114842706",
      appId: "1:367114842706:web:0f6d504163ed3c72ed658b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const filePath = "text_txt"; // same as before

    const loginBox = document.getElementById("loginBox");
    const emailInput = document.getElementById("email");
    const passInput = document.getElementById("password");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const textarea = document.getElementById("text-content");
    const saveBtn = document.getElementById("saveBtn");
    const reloadBtn = document.getElementById("reloadBtn");
    const logBox = document.getElementById("log");

    function log(msg) {
      logBox.textContent += msg + "\n";
      logBox.scrollTop = logBox.scrollHeight;
    }

    // Auth state
    firebase.auth().onAuthStateChanged(user => {
      if (user && user.emailVerified) {
        loginBox.style.display = "none";
        logoutBtn.style.display = "inline-block";
        textarea.disabled = false;
        saveBtn.disabled = false;
        reloadBtn.disabled = false;
        log("Logged in as " + user.email);
        loadFile();
      } else {
        loginBox.style.display = "block";
        logoutBtn.style.display = "none";
        textarea.disabled = true;
        saveBtn.disabled = true;
        reloadBtn.disabled = true;
        log("Please login (only verified users allowed).");
      }
    });

    loginBtn.onclick = async () => {
      try {
        await firebase.auth().signInWithEmailAndPassword(emailInput.value, passInput.value);
        log("Login success");
      } catch (e) {
        log("Login error: " + e.message);
      }
    };

    logoutBtn.onclick = () => {
      firebase.auth().signOut();
      log("Logged out");
    };

    async function loadFile() {
      try {
        const snap = await db.ref(filePath).get();
        if (snap.exists()) {
          textarea.value = snap.val();
          log("File loaded");
        } else {
          textarea.value = "";
          log("No file found");
        }
      } catch (e) {
        log("Error loading: " + e.message);
      }
    }

    reloadBtn.onclick = loadFile;

    saveBtn.onclick = async () => {
      try {
        await db.ref(filePath).set(textarea.value);
        log("File saved");
      } catch (e) {
        log("Error saving: " + e.message);
      }
    };
  </script>
</body>
</html>
